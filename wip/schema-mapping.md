# Schema Mapping for Intent Trader Objects

This document provides a detailed mapping between existing data structures and the new canonical schema for Intent Trader v0.5.2. Use this reference when implementing schema conversion for prompt files and commands.

## Core Object Properties

All primary objects in the system should include these standard properties:

| Canonical Property | Description | Format | Required | Default |
|-------------------|-------------|--------|----------|---------|
| `schemaVersion` | Version of the schema | String | Yes | "0.5.2" |
| `id` | Globally unique identifier | String | Yes | - |
| `source` | Source system | String (enum) | Yes | - |
| `timestamp` | Creation time | ISO date-time | Yes | - |
| `origin` | Lineage information | Object | No | - |
| `origin.planId` | ID of originating plan | String | No | - |
| `origin.ideaId` | ID of originating idea | String | No | - |
| `origin.createdBy` | Command that created object | String | No | - |
| `origin.sourceCommand` | Full command text | String | No | - |

### Standard ID Formats

Use these ID format patterns for consistency:

- Trade Plans: `plan-YYYYMMDD` (e.g., `plan-20250520`)
- Trade Ideas: `idea-SOURCE-YYYYMMDD-SYMBOL-NN` (e.g., `idea-dp-20250520-AAPL-01`)
- Positions: `pos-YYYYMMDD-SYMBOL-NN` (e.g., `pos-20250520-AAPL-01`)
- Analysis Results: `SOURCE-analysis-YYYYMMDD` (e.g., `dp-analysis-20250520`)
- Session Logs: `session-YYYYMMDD` (e.g., `session-20250520`)

### Source Enum Values

Valid values for the `source` property:

- `manual`: User-created through direct input
- `dp`: Derived from DP morning call
- `mancini`: Derived from Mancini newsletter
- `vtf`: VTF source
- `moderator`: System moderator
- `system`: Auto-generated by Intent Trader
- `claude`: Generated by Claude AI

## Trade Idea Mapping

### Current DP Format → Canonical Format

| Current DP Property | Canonical Property | Notes |
|--------------------|-------------------|-------|
| `ticker` | `symbol` | Direct mapping |
| `direction` | `direction` | Direct mapping |
| `conviction.level` | `conviction.level` | Direct mapping |
| `conviction.phrases` | `conviction.phrases` | Direct mapping |
| `entryParameters.zone.min` | `entryParameters.zone.min` | Direct mapping |
| `entryParameters.zone.max` | `entryParameters.zone.max` | Direct mapping |
| `entryParameters.condition` | `entryParameters.condition` | Direct mapping |
| `exitParameters.stopLoss` | `exitParameters.stopLoss` | Direct mapping |
| `exitParameters.target` | `exitParameters.target` | Direct mapping |
| `rationale` | `rationale` | Direct mapping |
| `isDayAfterTrade` | `classifications.isDayAfterTrade` | Move to classifications object |
| `tradeDuration` | `tradeDuration` | Direct mapping |
| `frequency` | `frequency` | Direct mapping |
| `isFavorite` | `isFavorite` | Direct mapping |
| [not present] | `classifications.isBreakout` | New property, default false |
| [not present] | `classifications.isReversal` | New property, default false |
| [not present] | `classifications.isFlagPattern` | New property, default false |
| [not present] | `classifications.isFailedBreakdown` | New property, default false |
| [not present] | `classifications.isEarningsPlay` | New property, default false |
| [not present] | `classifications.isTrendFollow` | New property, default false |
| [not present] | `classifications.isRangePlay` | New property, default false |
| [not present] | `classifications.isGapFill` | New property, default false |
| [not present] | `classifications.isMomentumPlay` | New property, default false |

### Current Mancini Format → Canonical Format

| Current Mancini Property | Canonical Property | Notes |
|------------------------|-------------------|-------|
| `ticker` | `symbol` | Direct mapping |
| `direction` | `direction` | Direct mapping |
| `conviction` | `conviction.level` | Direct mapping |
| `entry` | `entryParameters.condition` | May require parsing |
| `entry.min` | `entryParameters.zone.min` | If present as object |
| `entry.max` | `entryParameters.zone.max` | If present as object |
| `targets` (array) | `exitParameters.target` | Use first target if multiple |
| `stop` | `exitParameters.stopLoss` | Direct mapping |
| `setup` | `setup` | Direct mapping |
| `notes` | `rationale` | Direct mapping |
| [not present] | `classifications.isBreakout` | Infer from setup if possible |
| [not present] | `classifications.isReversal` | Infer from setup if possible |
| [not present] | `classifications.isFlagPattern` | Infer from setup if possible |
| [not present] | `classifications.isFailedBreakdown` | Infer from setup if possible |
| [not present] | `classifications.isDayAfterTrade` | Infer from setup if possible |
| [not present] | `classifications.isTrendFollow` | Infer from setup if possible |
| [not present] | `classifications.isRangePlay` | Infer from setup if possible |
| [not present] | `classifications.isGapFill` | Infer from setup if possible |
| [not present] | `classifications.isMomentumPlay` | Infer from setup if possible |
| `category` | `category` | Direct mapping, but add as separate field, not in array structure |

## Position Mapping

### Current Position → Canonical Format

| Current Property | Canonical Property | Notes |
|-----------------|-------------------|-------|
| `ticker`/`symbol` | `symbol` | Direct mapping |
| `direction` | `direction` | Direct mapping |
| `entry.price` | `entry.price` | Direct mapping |
| `entry.date` | `entry.date` | Direct mapping |
| `entry.shares` | `entry.shares` | Direct mapping |
| `entry.contracts` | `entry.contracts` | Direct mapping |
| `stop` | `stop` | Direct mapping |
| `target` | `target` | Direct mapping |
| `setup` | `setup` | Direct mapping |
| `status` | `status` | Direct mapping |
| `exitDate` | `exitDate` | Direct mapping |
| `exitPrice` | `exitPrice` | Direct mapping |
| `profit.amount` | `profit.amount` | Direct mapping |
| `profit.percent` | `profit.percent` | Direct mapping |
| `profit.rMultiple` | `profit.rMultiple` | Direct mapping |
| `notes` | `notes` | Direct mapping |
| `conviction` | `conviction.level` | Direct mapping |
| `isRunner` | `isRunner` | Direct mapping |
| `isCorePosition` | `isCorePosition` | Direct mapping |
| [setup-specific] | `classifications.isBreakout` | Convert from setup description |
| [setup-specific] | `classifications.isReversal` | Convert from setup description |
| [setup-specific] | `classifications.isFlagPattern` | Convert from setup description |
| [setup-specific] | `classifications.isFailedBreakdown` | Convert from setup description |
| [setup-specific] | `classifications.isEarningsPlay` | Convert from setup description |
| [setup-specific] | `classifications.isDayAfterTrade` | Convert from setup description |
| [setup-specific] | `classifications.isTrendFollow` | Convert from setup description |
| [setup-specific] | `classifications.isRangePlay` | Convert from setup description |
| [setup-specific] | `classifications.isGapFill` | Convert from setup description |
| [setup-specific] | `classifications.isMomentumPlay` | Convert from setup description |

## Market Framework Mapping

### Current DP Market Context → Canonical Format

| Current DP Property | Canonical Property | Notes |
|---------------------|-------------------|-------|
| `futures.status` | `marketFramework.bias` | Map to enum value |
| `futures.catalysts` | `marketFramework.catalysts` | Direct mapping |
| `indices.dow.direction` | [custom mapping] | Use to inform overall bias |
| `indices.nasdaq.direction` | [custom mapping] | Use to inform overall bias |
| `keyMovers` | `marketFramework.keyMovers` | Direct mapping |
| `sentiment` | `marketFramework.character` | Direct mapping |
| [not present] | `marketFramework.mode` | Default to "auto" |
| [not present] | `marketFramework.modeConfidence` | Default to 50 |
| [not present] | `marketFramework.biasCondition` | Leave empty |

### Current Mancini Market Assessment → Canonical Format

| Current Mancini Property | Canonical Property | Notes |
|--------------------------|-------------------|-------|
| `mode` | `marketFramework.mode` | Direct mapping |
| `bias` | `marketFramework.bias` | Direct mapping |
| `modeConfidence` | `marketFramework.modeConfidence` | Direct mapping |
| `character`/`key_characteristic` | `marketFramework.character` | Direct mapping |
| `catalysts` | `marketFramework.catalysts` | Direct mapping |
| `bias_condition`/`context_notes` | `marketFramework.biasCondition` | Map from available context |

## Level Framework Mapping

### Current Levels → Canonical Format

| Current Property | Canonical Property | Notes |
|-----------------|-------------------|-------|
| `levels.indices.es.support` | `levelFramework.indices.es.support` | Map to standardized format |
| `levels.indices.es.resistance` | `levelFramework.indices.es.resistance` | Map to standardized format |
| `levels.indices.spx.support` | `levelFramework.indices.spx.support` | Map to standardized format |
| `levels.indices.spx.resistance` | `levelFramework.indices.spx.resistance` | Map to standardized format |
| `levels.stocks` | `levelFramework.stocks` | Direct mapping |
| `keyDecisionPoint` | `levelFramework.keyDecisionPoint` | Direct mapping |
| `zones` | `levelFramework.zones` | Direct mapping |

### Level Object Structure

Each level object should follow this structure:

```json
{
  "price": 5900,
  "notes": "Trapped several times",
  "type": "major",
  "strength": "strong"
}
```

Valid `type` values:
- `major`: Primary support/resistance level with high significance
- `minor`: Secondary support/resistance level with moderate impact
- `psychological`: Round-number level with market psychology impact
- `key`: Critical decision point level
- `vwap`: Volume-weighted average price level
- `pivot`: Mathematical pivot point

Valid `strength` values:
- `strong`: Well-tested level with high probability of respect
- `moderate`: Moderately reliable level
- `weak`: Untested or weakly respected level

## Scenario Planning Mapping

### Current Scenario → Canonical Format

| Current Property | Canonical Property | Notes |
|-----------------|-------------------|-------|
| `type` | `type` | Direct mapping |
| `conviction` | `conviction` | Direct mapping |
| `trigger` | `trigger` | Direct mapping |
| `targets` | `targets` | Direct mapping |
| `stop` | `stop` | Direct mapping |
| `risk_reward` | `risk_reward` | Direct mapping |
| `probability` | `probability` | Direct mapping |
| `description` | `description` | Direct mapping |

## Trade Duration Mapping

Ensure consistent trade duration values:

| Value | Description |
|-------|-------------|
| `cashflow` | Intraday scalp (minutes to hours) |
| `day` | Single day trade (close by end of session) |
| `swing` | Multi-day position (days to weeks) |
| `position` | Intermediate hold (weeks to months) |
| `long-term` | Extended hold (months+) |

## Classification Mapping Guidelines

When converting from text descriptions to boolean flags, use these guidelines:

| Text Pattern | Classification Flag | Value |
|--------------|---------------------|-------|
| "breakout", "break out", "breaking out", "break above" | `isBreakout` | true |
| "reversal", "reverse", "trend change", "change in trend" | `isReversal` | true |
| "flag", "bull flag", "bear flag", "flag pattern" | `isFlagPattern` | true |
| "failed breakdown", "breakdown failure", "reclaim after breakdown" | `isFailedBreakdown` | true |
| "earnings", "ER play", "earnings announcement" | `isEarningsPlay` | true |
| "day after", "day-after-earnings", "DAT", "next day" | `isDayAfterTrade` | true |
| "trend", "with trend", "trend following", "in trend" | `isTrendFollow` | true |
| "range", "range-bound", "within range", "consolidation" | `isRangePlay` | true |
| "gap", "gap fill", "fill the gap", "filling gap" | `isGapFill` | true |
| "momentum", "momo", "moving fast", "parabolic" | `isMomentumPlay` | true |

## JSON Schema Validation

To validate objects against the canonical schema, add this section to your implementation:

```javascript
function validateAgainstSchema(obj, schemaType) {
  // Check required base fields
  if (!obj.schemaVersion || obj.schemaVersion !== "0.5.2") {
    return { valid: false, error: "Missing or invalid schemaVersion" };
  }
  
  if (!obj.id || typeof obj.id !== "string") {
    return { valid: false, error: "Missing or invalid id" };
  }
  
  if (!obj.source || !["manual", "dp", "mancini", "vtf", "moderator", "system", "claude"].includes(obj.source)) {
    return { valid: false, error: "Missing or invalid source" };
  }
  
  if (!obj.timestamp || !/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/.test(obj.timestamp)) {
    return { valid: false, error: "Missing or invalid timestamp" };
  }
  
  // Type-specific validation
  switch (schemaType) {
    case "tradeIdea":
      if (!obj.symbol || typeof obj.symbol !== "string") {
        return { valid: false, error: "Missing or invalid symbol" };
      }
      if (!obj.direction || !["long", "short"].includes(obj.direction)) {
        return { valid: false, error: "Missing or invalid direction" };
      }
      if (!obj.conviction || !obj.conviction.level || 
          !["focus-trade", "high", "medium", "low", "negative"].includes(obj.conviction.level)) {
        return { valid: false, error: "Missing or invalid conviction level" };
      }
      break;
    
    case "tradePosition":
      // Add position-specific validation
      break;
      
    case "tradePlan":
      // Add plan-specific validation
      break;
  }
  
  return { valid: true };
}
```

## Examples of Converted Objects

### Trade Idea Example

```json
{
  "schemaVersion": "0.5.2",
  "id": "idea-dp-20250520-AAPL-01",
  "source": "dp",
  "timestamp": "2025-05-20T08:30:00Z",
  "symbol": "AAPL",
  "direction": "long",
  "conviction": {
    "level": "high",
    "phrases": ["really like this setup", "strong conviction long"]
  },
  "entryParameters": {
    "zone": {
      "min": 210.50,
      "max": 212.75
    },
    "condition": "entry above 212.75 with volume",
    "strategy": "limit"
  },
  "exitParameters": {
    "stopLoss": 205.80,
    "target": 225.00,
    "strategy": "Scale out approach, 50% at first target",
    "trimLevels": [
      {
        "price": 218.50,
        "percentage": 50
      },
      {
        "price": 225.00,
        "percentage": 50
      }
    ]
  },
  "rationale": "Breaking out of bull flag consolidation with increasing volume and positive sector correlation",
  "tradeDuration": "swing",
  "setup": "bull-flag-breakout",
  "classifications": {
    "isBreakout": true,
    "isReversal": false,
    "isFlagPattern": true,
    "isFailedBreakdown": false,
    "isEarningsPlay": false,
    "isDayAfterTrade": false,
    "isTrendFollow": true,
    "isRangePlay": false,
    "isGapFill": false,
    "isMomentumPlay": true
  },
  "positionSizing": {
    "recommendation": "full",
    "reasoning": "High conviction pattern with clear risk parameters"
  },
  "risk": {
    "plannedRMultiple": 2.3
  },
  "origin": {
    "sourceCommand": "/analyze-dp",
    "createdBy": "dp-analyzer"
  }
}
```

### Trade Plan Example

```json
{
  "schemaVersion": "0.5.2",
  "id": "plan-20250520",
  "source": "system",
  "timestamp": "2025-05-20T08:45:00Z",
  "date": "2025-05-20",
  "marketFramework": {
    "bias": "neutral-to-bullish",
    "biasCondition": "bullish above 5926, bearish below 5880",
    "mode": "Mode 2",
    "modeConfidence": 80,
    "character": "Consolidation in bull flag pattern",
    "catalysts": ["CPI data release at 8:30 AM", "FOMC minutes tomorrow"]
  },
  "levelFramework": {
    "indices": {
      "es": {
        "support": [
          {
            "price": 5900,
            "notes": "Multiple tests with strong rejection",
            "type": "major",
            "strength": "strong"
          },
          {
            "price": 5880,
            "notes": "Prior breakdown level now support",
            "type": "major",
            "strength": "moderate"
          }
        ],
        "resistance": [
          {
            "price": 5945,
            "notes": "Recent high",
            "type": "major",
            "strength": "moderate"
          },
          {
            "price": 5970,
            "notes": "Measured move target",
            "type": "minor",
            "strength": "weak"
          }
        ]
      },
      "spx": {
        "support": [
          {
            "price": 5920,
            "notes": "Equivalent to ES 5900",
            "type": "major",
            "strength": "strong"
          },
          {
            "price": 5900,
            "notes": "Equivalent to ES 5880",
            "type": "major",
            "strength": "moderate"
          }
        ],
        "resistance": [
          {
            "price": 5965,
            "notes": "Equivalent to ES 5945",
            "type": "major",
            "strength": "moderate"
          },
          {
            "price": 5990,
            "notes": "Equivalent to ES 5970",
            "type": "minor",
            "strength": "weak"
          }
        ]
      }
    },
    "zones": [
      {
        "min": 5900,
        "max": 5926,
        "notes": "Current consolidation range",
        "type": "consolidation"
      },
      {
        "min": 5926,
        "max": 5945,
        "notes": "Initial breakout zone",
        "type": "decision"
      }
    ],
    "keyDecisionPoint": 5926
  },
  "scenarioPlanning": [
    {
      "type": "long",
      "conviction": "high",
      "trigger": "reclaim above 5926 with volume",
      "targets": [5945, 5970],
      "stop": 5905,
      "risk_reward": 2.5,
      "probability": 65,
      "description": "Breakout from consolidation targeting prior highs and measured move"
    },
    {
      "type": "short",
      "conviction": "medium",
      "trigger": "breakdown below 5880 with follow-through",
      "targets": [5860, 5840],
      "stop": 5895,
      "risk_reward": 2.0,
      "probability": 35,
      "description": "Breakdown from range targeting next support level"
    }
  ],
  "riskManagement": {
    "accountSize": 100000,
    "maxRiskPercent": 1,
    "dailyRiskAmount": 1000,
    "positionSizing": "Risk 0.5% on primary setups, 0.25% on secondary",
    "stopPlacement": "Place stops below key support for longs, above key resistance for shorts",
    "trailStrategy": "Trail to breakeven after 50% of target reached"
  },
  "metadata": {
    "generatedFrom": ["dp-analysis-20250520", "mancini-analysis-20250520"],
    "generationTimestamp": "2025-05-20T08:45:00Z"
  },
  "origin": {
    "sourceCommand": "/create-plan",
    "createdBy": "plan-generator"
  }
}
```

## Common Schema Conversion Errors

| Error | Resolution |
|-------|------------|
| Missing required fields | Ensure all base objects have schemaVersion, id, source, and timestamp |
| Incorrect enum values | Use only prescribed enum values for direction, conviction, etc. |
| Invalid date-time format | Use ISO 8601 format with Z suffix (e.g., "2025-05-20T08:45:00Z") |
| Inconsistent camelCase | Use camelCase for all property names (convert from snake_case if present) |
| Excessive nesting | Keep maximum nesting to 3 levels for Claude compatibility |
| Array vs. object confusion | Prefer arrays for collections rather than object properties |

## Minimum Schema Support Requirements

At minimum, converted prompt files must:

1. Reference the trading-intent.schema.json file in their front matter
2. Use the canonical schema's field names in all examples
3. Include validation instructions for schema structure
4. Generate all required fields in output objects
5. Provide schema-compliant example responses
6. Use boolean flags for all classification properties
7. Maintain consistent enum values across the system
